<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Failed - Nomado</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .failure-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .failure-card {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border-radius: 15px;
            padding: 3rem 2rem;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        .failure-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M20,20 L80,80 M80,20 L20,80" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/></svg>');
            opacity: 0.1;
            pointer-events: none;
        }
        .failure-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: shake 1s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .error-details {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .error-reason {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        .btn-action {
            padding: 1rem;
            border-radius: 8px;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: transform 0.2s ease;
        }
        .btn-action:hover {
            transform: translateY(-2px);
            text-decoration: none;
        }
        .troubleshooting {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .troubleshooting-item {
            display: flex;
            align-items: flex-start;
            margin: 1rem 0;
            gap: 1rem;
        }
        .troubleshooting-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #6c757d;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.8rem;
        }
        .support-section {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <div class="container failure-container">
        <!-- Failure Header -->
        <div class="failure-card">
            <div class="failure-icon">
                <i class="fas fa-times-circle"></i>
            </div>
            <h1>Payment Failed</h1>
            <p class="mb-0">Unfortunately, your payment could not be processed</p>
        </div>

        <!-- Error Details -->
        <div class="error-details">
            <h4><i class="fas fa-exclamation-triangle text-warning"></i> Transaction Details</h4>
            <div class="detail-row">
                <span><strong>Transaction ID:</strong></span>
                <span>{{ transaction.transaction_id }}</span>
            </div>
            <div class="detail-row">
                <span><strong>Attempt Date:</strong></span>
                <span>{{ transaction.initiated_at|date:"M d, Y - H:i" }}</span>
            </div>
            <div class="detail-row">
                <span><strong>Amount:</strong></span>
                <span>â‚¹{{ transaction.amount }}</span>
            </div>
            <div class="detail-row">
                <span><strong>Status:</strong></span>
                <span class="text-danger">{{ transaction.status }}</span>
            </div>
            
            {% if failure_reason %}
            <div class="error-reason">
                <strong><i class="fas fa-info-circle"></i> Reason for Failure:</strong><br>
                {{ failure_reason }}
            </div>
            {% endif %}
        </div>

        <!-- Troubleshooting Tips -->
        <div class="troubleshooting">
            <h5><i class="fas fa-tools"></i> Common Solutions</h5>
            <p class="text-muted">Try these steps to resolve payment issues:</p>
            
            <div class="troubleshooting-item">
                <div class="troubleshooting-icon">1</div>
                <div>
                    <strong>Check Your Payment Details</strong>
                    <p class="mb-0">Verify your card number, expiry date, and CVV are correct</p>
                </div>
            </div>
            
            <div class="troubleshooting-item">
                <div class="troubleshooting-icon">2</div>
                <div>
                    <strong>Sufficient Balance</strong>
                    <p class="mb-0">Ensure you have sufficient balance in your account</p>
                </div>
            </div>
            
            <div class="troubleshooting-item">
                <div class="troubleshooting-icon">3</div>
                <div>
                    <strong>Bank Authorization</strong>
                    <p class="mb-0">Some banks require authorization for online transactions</p>
                </div>
            </div>
            
            <div class="troubleshooting-item">
                <div class="troubleshooting-icon">4</div>
                <div>
                    <strong>Try Different Payment Method</strong>
                    <p class="mb-0">Use UPI, net banking, or a different card</p>
                </div>
            </div>
            
            <div class="troubleshooting-item">
                <div class="troubleshooting-icon">5</div>
                <div>
                    <strong>Clear Browser Cache</strong>
                    <p class="mb-0">Clear your browser cache and cookies, then try again</p>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="{% url 'retry_payment' transaction.transaction_id %}" class="btn btn-danger btn-action">
                <i class="fas fa-redo"></i> Retry Payment
            </a>
            
            {% if transaction.hotel_booking %}
                <a href="{% url 'hotel_detail' transaction.hotel_booking.hotel.id %}" class="btn btn-outline-primary btn-action">
                    <i class="fas fa-arrow-left"></i> Back to Hotel
                </a>
            {% elif transaction.transport_booking %}
                <a href="{% url 'route_detail' transaction.transport_booking.route.id %}" class="btn btn-outline-primary btn-action">
                    <i class="fas fa-arrow-left"></i> Back to Route
                </a>
            {% endif %}
            
            <a href="{% url 'payment_dashboard' %}" class="btn btn-outline-secondary btn-action">
                <i class="fas fa-tachometer-alt"></i> Payment Dashboard
            </a>
            
            <a href="/" class="btn btn-success btn-action">
                <i class="fas fa-home"></i> Back to Home
            </a>
        </div>

        <!-- Support Section -->
        <div class="support-section">
            <h5><i class="fas fa-headset"></i> Need Help?</h5>
            <p>Our customer support team is here to help you complete your booking</p>
            <div class="row">
                <div class="col-md-4">
                    <i class="fas fa-phone fa-2x text-primary mb-2"></i>
                    <p><strong>Call Us</strong><br>+91-XXXX-XXXXXX</p>
                </div>
                <div class="col-md-4">
                    <i class="fas fa-envelope fa-2x text-primary mb-2"></i>
                    <p><strong>Email</strong><br>support@nomado.com</p>
                </div>
                <div class="col-md-4">
                    <i class="fas fa-comments fa-2x text-primary mb-2"></i>
                    <p><strong>Live Chat</strong><br>Available 24/7</p>
                </div>
            </div>
        </div>

        <!-- Footer Message -->
        <div class="text-center mt-4">
            <p class="text-muted">
                <i class="fas fa-shield-alt"></i> 
                Your booking is held for 30 minutes. Complete payment to confirm.
            </p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-retry functionality (optional)
        let retryCount = 0;
        const maxRetries = 3;

        function autoRetry() {
            if (retryCount < maxRetries) {
                setTimeout(() => {
                    retryCount++;
                    console.log(`Auto-retry attempt ${retryCount}`);
                    // You could implement auto-retry logic here if needed
                }, 5000); // Wait 5 seconds before retry
            }
        }

        // Smooth scroll to troubleshooting section
        function showTroubleshooting() {
            document.querySelector('.troubleshooting').scrollIntoView({
                behavior: 'smooth'
            });
        }

        // Track failed payment for analytics
        window.addEventListener('load', function() {
            // You can add analytics tracking here
            console.log('Payment failed - tracking for improvement');
        });
    </script>
</body>
</html>